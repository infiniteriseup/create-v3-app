#!/usr/bin/env node
import{resolve as y}from"path";import a from"fs-extra";import B from"ora";import K from"inquirer";import k from"path";import{fileURLToPath as M}from"url";import L from"figlet";var U=M(import.meta.url),F=k.dirname(U),f=k.join(F,"../"),C=L.textSync("Create V3 App",{font:"Epic"}),A="my-v3-app",I="create-v3-app";import w from"chalk";import V from"gradient-string";var O=()=>{let t=V(Object.values(["#2ef232","#00e96b","#00dd96","#00d0b8","#00c1d2","#00b1e0","#00a0e3","#008ddb","#007bc9"]));console.log(t.multiline(C))},c=(...t)=>w.red(...t),h=(...t)=>w.yellow(...t),p=(...t)=>w.cyan(...t),m=(...t)=>w.green(...t),i={error(...t){console.log(c(...t))},warn(...t){console.log(h(...t))},info(...t){console.log(p(...t))},success(...t){console.log(m(...t))}};var j=async({projectName:t,projectDir:n},e)=>{if(!a.existsSync(n))return;if(a.readdirSync(n).length===0&&!(t===".")){e.info(`${p(t)} exists but is empty, continuing...
`);return}e.stopAndPersist();let{shouldAbort:o}=await K.prompt({name:"shouldAbort",type:"list",message:`${h("Warning:")} ${h(t)} already exists and isn't empty. How would you like to proceed?`,choices:[{name:"Abort installation (recommended)",value:!0,short:"Abort"},{name:"Clear the directory and continue installation",value:!1,short:"Clear"}],default:!0});o&&(e.fail("Aborting installation..."),process.exit(1)),e.info(`Emptying ${p(t)} and creating t3 app..
`),a.emptyDirSync(n)},q=t=>{a.readdirSync(t).forEach(e=>{e.startsWith("_")&&a.renameSync(y(t,e),y(t,`.${e.slice(1)}`))})},G=async({projectName:t,projectDir:n})=>{let e=B(`Creating project in: ${n}...
`).start();await j({projectName:t,projectDir:n},e),e.start();let r=y(f,"template");a.copySync(r,n),q(n);let s=t==="."?"App":p(t);e.succeed(`${s} ${m("scaffolded successfully!")}
`)};import H from"chalk";import{execSync as x}from"child_process";import{execa as u}from"execa";import E from"fs-extra";import S from"inquirer";import X from"ora";import b from"path";var Y=t=>{try{return x("git --version",{cwd:t}),!0}catch{return!1}},J=t=>E.existsSync(b.join(t,".git")),Q=async t=>{try{return await u("git",["rev-parse","--is-inside-work-tree"],{cwd:t,stdout:"ignore"}),!0}catch{return!1}},Z=()=>{let n=x("git --version").toString().trim().split(" ")[2],[e,r]=n?.split(".")||[0,0];return{major:Number(e),minor:Number(r)}},D=()=>x("git config --global init.defaultBranch || echo main").toString().trim(),tt=async(t,n)=>{if(!J(t))return!1;let r=await Q(t),s=b.parse(t).name;if(r){n.stop();let{overwriteGit:o}=await S.prompt({name:"overwriteGit",type:"confirm",message:`${c("Warning:")} Git is already initialized in "${s}". Initializing a new git repository would delete the previous history. Would you like to continue anyways?`,default:!1});return o&&E.removeSync(b.join(t,".git")),!o}else{n.stop();let{initializeChildGitRepo:o}=await S.prompt({name:"initializeChildGitRepo",type:"confirm",message:`${c("Warning:")} "${s}" is already in a git worktree. Would you still like to initialize a new git repository in this directory?`,default:!1});return!o}},_=async t=>{if(i.info("Initializing Git..."),!Y(t)){i.warn("Git is not installed. Skipping Git initialization.");return}let n=X(`Creating a new git repo...
`).start();if(await tt(t,n)){n.info("Skipping git initialization...");return}try{let r=D(),{major:s,minor:o}=Z();s<2||o<28?(await u("git",["init"],{cwd:t}),await u("git",["branch","-m",r],{cwd:t})):await u("git",["init",`--initial-branch=${r}`],{cwd:t}),await u("git",["add","."],{cwd:t}),n.succeed(`${m("Successfully initialized and staged")} ${H.green.bold("git")}
`)}catch{n.fail(`${c("Failed:")} could not initialize git. Update git to the latest version!
`)}};import it from"chalk";import{execa as v}from"execa";import P from"ora";import{resolve as nt,basename as et}from"path";var l=()=>{let t=process.env.npm_config_user_agent;return t?.startsWith("yarn")?"yarn":t?.startsWith("pnpm")?"pnpm":"npm"},ot=/^(?:@[a-z0-9-*~][a-z0-9-*._~]*\/)?[a-z0-9-~][a-z0-9-._~]*$/,$=t=>{let n=t.split("/"),e=n.findIndex(s=>s.startsWith("@")),r=n[n.length-1];return n.findIndex(s=>s.startsWith("@"))!==-1&&(r=n.slice(e).join("/")),t==="."||ot.test(r??"")?!0:"App name must consist of only lowercase alphanumeric characters, '-', and '_'"},T=t=>{let n=t.split("/"),e=n[n.length-1];if(e==="."){let o=nt(process.cwd());e=et(o)}let r=n.findIndex(o=>o.startsWith("@"));r!==-1&&(e=n.slice(r).join("/"));let s=n.filter(o=>!o.startsWith("@")).join("/");return[e,s]};var rt=async t=>(await v("npm",["install"],{cwd:t,stderr:"inherit"}),P()),st=async t=>{let n=P("Running yarn...").start(),e=v("yarn",[],{cwd:t,stdout:"pipe"});return await new Promise((r,s)=>{e.stdout?.on("data",o=>{n.text=o.toString()}),e.on("error",o=>s(o)),e.on("close",()=>r())}),n},at=async t=>{let n=P("Running pnpm install...").start(),e=v("pnpm",["install"],{cwd:t,stdout:"pipe"});return await new Promise((r,s)=>{e.stdout?.on("data",o=>{let g=o.toString();g.includes("Progress")&&(n.text=g.includes("|")?g.split(" | ")[1]??"":g)}),e.on("error",o=>s(o)),e.on("close",()=>r())}),n},lt=async(t,n)=>{switch(t){case"npm":return rt(n);case"pnpm":return at(n);case"yarn":return st(n)}},W=async t=>{i.info("Installing dependencies...");let n=l();(await lt(n,t)).succeed(it.green(`Successfully installed dependencies!
`))};var z=(t,n)=>{let e=l();i.info("Next steps:"),t!=="."&&i.info(`  cd ${t}`),n.noInstall&&i.info(`  ${e} ${e==="yarn"?"":"install"}`),i.info(`  ${e==="npm"?"npx":e} prisma db push`),i.info(`  ${e==="npm"?"npm run":e} dev`)};import{Command as ct}from"commander";import d from"inquirer";import pt from"asciify-image";import{resolve as mt}from"path";var R={name:A,noGit:!1,noInstall:!1},ut=async()=>{if(!(process.env.SHELL?.toLowerCase().includes("git")&&process.env.SHELL?.includes("bash")))return{interactive:!0,shouldContinue:!0};i.warn(`WARNING: It looks like you are using Git Bash which is non-interactive. In order to provide options with the interactive CLI, please run create-v3t3-app with another
      terminal.`);let{shouldContinue:n}=await d.prompt({name:"shouldContinue",type:"confirm",message:"Continue scaffolding a default V3 app?",default:!0});return{interactive:!1,shouldContinue:n}},dt=()=>{let t=new ct().name(I);return t.description("A CLI for creating web applications with the v3 stack").argument("[dir]","The name of the application, as well as the name of the directory to create").option("--noGit","Explicitly tell the CLI to not initialize a new git repo in the project",!1).option("--noInstall","Explicitly tell the CLI to not run the package manager's install command",!1).parse(process.argv),{...t.opts(),name:t.args[0]}},gt=async()=>{let{name:t}=await d.prompt({name:"name",type:"input",message:"What will your project be called?",default:R.name,validate:$,transformer:n=>n.trim()});return t},ft=async()=>{let{git:t}=await d.prompt({name:"git",type:"confirm",message:"Initialize a new git repository?",default:!0});return t},wt=async()=>{let t=l(),{install:n}=await d.prompt({name:"install",type:"confirm",message:`Would you like us to run '${t}`+(t==="yarn"?"'?":" install'?"),default:!0});return n},ht=async()=>{let t=dt();return Object.assign(t,{name:t.name||await gt(),noGit:t.noGit||!await ft(),noInstall:t.noGit||!await wt()})},yt=async()=>{let{language:t}=await d.prompt({name:"language",type:"list",message:"Which styling solutions would you like to use ?",choices:[{name:"Open Props",value:"openprops",short:"openprops"},{name:"Tailwind",value:"tailwind",short:"tailwind"}],default:"openprops"});if(t==="tailwind"){let n=await pt(mt(f,"src/assets/duck.jpg"),{fit:"box",width:20,height:20});console.log(n),i.info("Wrong choice KEKW"),i.info("Create V3 App believes in web fundamentals and doesn't support tailwind out of the box."),i.info("See https://create-v3-app.vercel.app/docs/why-no-tailwind"),i.info("Don't worry, you can easily setup tailwind yourself by adding the tailwind nuxt module.")}else i.success("Ah, I see you are a person of culture.")},N=async()=>{let{shouldContinue:t,interactive:n}=await ut();t||process.exit(0);let e=n?await ht():R;return await yt(),e};(async function(){O();let t=await N(),[n,e]=T(t.name);await G({projectName:n,projectDir:e}),t.noInstall||await W(e),t.noGit||await _(e),z(n,t),process.exit(0)})().catch(t=>{i.error("Aborting installation..."),t instanceof Error?i.error(t):(i.error("An unknown error has occurred. Please open an issue on github with the below:"),console.log(t)),process.exit(1)});
//# sourceMappingURL=index.js.map